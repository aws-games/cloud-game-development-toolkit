################################################################################\n# SSM Document for ScyllaDB Datacenter Configuration\n################################################################################\n\n# Configure ScyllaDB datacenter name to match DDC expectations\nresource \"aws_ssm_document\" \"scylla_datacenter_config\" {\n  name            = \"${local.name_prefix}-scylla-datacenter-config\"\n  document_format = \"YAML\"\n  document_type   = \"Command\"\n  \n  content = <<DOC\nschemaVersion: '1.2'\ndescription: Configure ScyllaDB datacenter name to use full region.\nruntimeConfig:\n  aws:runShellScript:\n    properties:\n      - id: 0.aws:runShellScript\n        runCommand:\n          - |\n            # Configure datacenter name\n            echo \"dc=${replace(var.region, \"-\", \"_\")}\" > /etc/scylla/cassandra-rackdc.properties\n            echo \"rack=1a\" >> /etc/scylla/cassandra-rackdc.properties\n            # Restart ScyllaDB to pick up new datacenter name\n            systemctl restart scylla-server\n            # Wait for ScyllaDB to be ready\n            sleep 60\nDOC\n  \n  tags = merge(var.tags, {\n    Name = \"${local.name_prefix}-scylla-datacenter-config\"\n  })\n}\n\n# Run datacenter configuration on all ScyllaDB nodes\nresource \"aws_ssm_association\" \"scylla_datacenter_config\" {\n  name = aws_ssm_document.scylla_datacenter_config.name\n  \n  targets {\n    key    = \"tag:Name\"\n    values = [\"${local.name_prefix}-scylla*\"]\n  }\n  \n  depends_on = [aws_instance.scylla_ec2_instance_seed, aws_instance.scylla_ec2_instance_other_nodes]\n}\n