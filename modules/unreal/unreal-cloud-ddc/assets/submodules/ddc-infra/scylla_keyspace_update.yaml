schemaVersion: '1.2'
description: Alter the keyspaces of each of the local keyspaces in ScyllaDB nodes to set the replication factor for multi-region deployment.
parameters:
  regions:
    type: String
    description: Regions to include as datacenters
    default: "${primary_dc},${secondary_dc}"
runtimeConfig:
  aws:runShellScript:
    properties:
      - id: "0.aws:runShellScript"
        runCommand:
          - |
            cqlsh --request-timeout=120 -e "ALTER KEYSPACE jupiter_local_ddc_${primary_region} WITH replication = {'class': 'NetworkTopologyStrategy', '${primary_dc}': 0, '${secondary_dc}': 0};" && \
            cqlsh --request-timeout=120 -e "ALTER KEYSPACE jupiter_local_ddc_${primary_region} WITH replication = {'class': 'NetworkTopologyStrategy', '${primary_dc}': 1, '${secondary_dc}': 0};" && \
            cqlsh --request-timeout=120 -e "ALTER KEYSPACE jupiter_local_ddc_${primary_region} WITH replication = {'class': 'NetworkTopologyStrategy', '${primary_dc}': 2, '${secondary_dc}': 0};" && \
            cqlsh --request-timeout=120 -e "ALTER KEYSPACE jupiter_local_ddc_${secondary_region} WITH replication = {'class': 'NetworkTopologyStrategy', '${secondary_dc}': 0, '${primary_dc}': 0};" && \
            cqlsh --request-timeout=120 -e "ALTER KEYSPACE jupiter_local_ddc_${secondary_region} WITH replication = {'class': 'NetworkTopologyStrategy', '${secondary_dc}': 1, '${primary_dc}': 0};" && \
            cqlsh --request-timeout=120 -e "ALTER KEYSPACE jupiter_local_ddc_${secondary_region} WITH replication = {'class': 'NetworkTopologyStrategy', '${secondary_dc}': 2, '${primary_dc}': 0};"